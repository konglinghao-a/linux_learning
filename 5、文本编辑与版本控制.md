# 5、文本编辑与版本控制

## 5-1 高级文本编辑器，安装启动 Vim

两件文本编辑器的 “神器”：Vim 和 Emacs

### Vim

- Vi 文本编辑器的进阶版，是 Vi iMproved 的缩写，表示"改进了的 Vi"（在 Linux 中一般默认安装）

### Emacs

- 著名的开源先驱 Richard Stallman 开发的文本编辑器，后来有很多人参与改进 Emacs（在 Linux 默认没有安装）

### 安装 Vim

-  sudo yum install vim（大部分 Linux 发行版都是默认安装的，但是不排除少部分没安装）
- 安装完了以后输入 vim 就能启动 vim 文本编辑器

### vimtutor：vim 的教程程序

- vim 中内嵌了一个教程小程序
- 输入 vimtutor 就能执行

## 5-2  vim 的多种模式和基本操作

### vim 的多种模式

- 交互模式
- 插入模式
- 命令模式
- 可视模式（一般不太用）

### vim 的交互模式

- 交互模式：interactive mode；也称为正常模式（Normal Mode）
- 这是 vim 的默认模式。每次运行 vim 程序的时候，就会进入这个模式
- 在这个模式中，你不能输入文本
- 它可以让我们在文本间移动，删除一行文本，复制粘贴文本，跳转到指定行，撤销操作等等

### vim 的插入模式

- 插入模式：insert mode
- 就是我们平时可以打字的那种模式
- 进入这个模式有几种方法：
  - 按 i ：最常见的方法
  - 其他进入插入模式的方法：I（大写的 i）、a 和 A、o 和 O
  - s 键：删除光标所在的字符并进入插入模式
  - S 键：删除光标所在的行并进入插入模式
- 退出这种模式，只需要按下 ESC（escape） 键

### vim 的命令模式

- 命令（行）模式：Command Mode 或 Command-Line Mode；也可以称为底线命令模式（Last line mode）
- 在这个模式下可以运行一些命令例如“退出”、“保存”等等
- 也可以用这个模式来激活一些 vim 的配置，例如语法高亮，显示行号等等
- 也可以发送一些命令给终端命令行，例如 ls、cp 等等
- 为了进入这个模式下，我们首先需要处于交互模式下，然后按 :（冒号）键，输入命令然后再按回车，就会执行此命令；执行了命令以后就会又回到交互模式了（当然了，你冒号打到一半，直接按 ESC 也可以回到交互模式）

![](./media/86.png)

### 图形界面的 vim：gVim

- vim 也有一个图形界面的版本，称为gVim（Gnome Vim 的缩写）
- gVim 的功能和 vim 是基本一样的
- gVim 也有 windows 版本

### 基本操作（移动，写入，保存，等等）

**打开 vim**

- 在终端直接输入 vim 就可以运行起来
- 也可以用 vim 来打开一个文件，只需要在 vim 后面再加文件名
- **vim 文件名**：如果文件不存在，那么就会被创建

**移动：h，j，k，l（上下左右移动）**

- 在 vim 的交互模式下，我们可以在文本中移动光标（用方向是一样的）

| 按键 | 作用             |
| ---- | ---------------- |
| h    | 向左移动一个字符 |
| j    | 向下移动一个字符 |
| k    | 向上移动一个字符 |
| l    | 向右移动一个字符 |

**0：移动到行首**

- 在交互模式下，数字 0 可以将光标定位到一行的开始位置（跟 home 键一样）

**$：移动到行末**

- 在交互模式下，$ 可以将光标定位到一行的行末（跟 End 键一样）

**w：一个单词一个单词移动**

- 在交互模式下，按 w 可以一个单词一个单词移动

**:w 保存文件**

- 在交互模式下，按下冒号键（:），可以进入命令模式
- 再按下 w（w 是 write 的首字母，是英语 "写入" 的意思）
- :w myfile：写入文件，文件取名为 myfile

**:q 退出**

- 在交互模式中，先按下冒号键以进入命令模式，再按下 q 键

**:q! 强制退出**

- 在交互模式中，先按下冒号键以进入命令模式，再按下 q! 键，没保存就可以直接退出了

**:wq 保存然后退出**

- 两个命令的组合：w 和 q

**:x 保存然后退出**

- 和 :wq 的效果一样

## 5-3 vim 的标准和高级操作

### 标准操作（复制，粘贴，撤销，等等）

### x：删除字符

- 在**交互模式**下，将光标定位到你想删除的字符上，然后按 x ，就能删除这个字符
- 效果和在**插入模式**下用 BackSpace 键（退格键）来删除字符差不多
- 删除多个字符：先按数字键，然后再按 x 
  - 先按 4，然后按 x，这样就删掉了 4 个字符

### d：删除单词，行，等等

- 在**交互模式**下，用字母键 d 来删除单词或者行
- d 是 delete 的首字母
- 被删除的内容会被暂存在内存里，就好像剪切
- 被剪贴之后的内容是可以被粘贴的（用 p 键）

**dd：删除行**

- 连按两次 d 来删除光标所在的那一行。
- 删除多行：先按数字，然后再按 dd

**dw：删除一个单词**

- 将光标置于一个单词的首字母处，然后按下 dw（delete word），整个单词就会被删除
- 如果光标置于单词中的某个字符上，那么只会删除从当前字符开始到下一个空格前的所有字符
- 删除多个单词：先按数字，然后再按 dw（也可以把数字放到 dw 的中间，如 d3w）

**d0 和 d$：删除行首或行末**

- 按下 d 键，再加 0 键，就会删除从光标处到行首的所有字符
- 按下 $ 键，再加 0 键，就会删除从光标处到行末的所有字符

### yy：复制行到内存中

- y 是 yank（拔出，抽出） 的首字母
- 按两次 y 会把光标所在行复制到内存中（和 dd 类似，dd 用于 “剪切” 光标所在行到内存中，而 yy 是 “复制”）
- yw 是复制一个单词（和 dw 类似）
- y$ 是复制从所在处到行末的所有内容（和 d$ 类似）
- y0 是复制从所在处到行首的所有内容（和 d0 类似）

### p：粘贴

- 如果之前用 dd 来剪切过一行，或者用 yy 来复制过一行，或者是同类操作（比如 y$，dw，y0，d0 等），那么都可以用 p 来粘贴这些内容
- 粘贴多次：先按数字，然后再按 ｐ

### r：替换一个字符

- 在**交互模式**下，将光标置于想要替换的字符上，按下 r 键，然后输入自己要替换的字符（rs 表示替换当前字符为 s）
- 如果按了大写的 R ，那就会进入**替换模式**，这时候可以替换多个字符（退出就按 esc）

### u：撤销操作

- 撤销一次：直接按 u
- 撤销多次：先按数字，然后再按 u

### ctrl + r：重做

- 为了取消撤销，也就是重做之前的修改，可以按 ctrl + r（redo）

### g：跳转到指定行

- go
- 跳到最后一行：按 **G**
- 跳到第一行：按 **gg**
- 跳到指定行：先按数字，然后按 G 或 gg
  - 如果要跳转到第 7 行，那就按下 7G（**注意，G 是大写**）；也可以按 7，然后按下 gg，也是一样的效果
- vim 中有行号，默认从 1 开始，默认没有显示
  - 显示行号：进入**命令模式**，输入 set nu（number 的意思）
  - 不显示行号：进入**命令模式**，输入 set nonu

### 高级操作（分屏，合并，查找，等等）

左右这些操作都是在**交互模式**下进行的。

### / ：查找

- 如果按下 /（斜杠键），那就进入了查找模式，然后输入要查找的字符串
- 如果要查找下一个匹配项，只需要按下 n 键（反向查找就按 N）
- 用斜杠来进行的查找是从当前光标处开始，向文件尾搜索；如果想要从当前光标处开始向文件开头搜索，那就将斜杠（/）替换为问号（？）即可，其他功能是一样的
- **取消高亮：:noh**

### :s  ：查找并替换

- 使用方法：**:s/旧字符串/新字符串**
  - 这种方法只会替换**光标所在行**的第一个匹配的字符串
- 使用方法：**:s/旧字符串/新字符串/g**
  - 替换**光标所在行**的所有匹配的旧字符串为新字符串
- 使用方法：**:#,# s/旧字符串/新字符串/g**
  - 替换文件中第 # 行到第 # 行的所有匹配的旧字符串为新字符串
- 使用方法：**:%s/旧字符串/新字符串/g**
  - 替换文件中所有匹配的字符串

### :r  ：合并文件

- 可以用 冒号 + r （:r）实现在光标处插入**一个文件的内容**
  - 例如：**:r 另一个文件名**

### 分屏

- 分屏可以同时打开好几个文件，分屏之后，屏幕的每一块被称为一个 viewport

**:sp  横向分屏**

- sp 是 split 的缩写，默认是横向分割
- 在两块分开的屏幕中分别打开不同的文件：**:sp 文件名**

**:vsp  垂直分屏**

- vertically split

**分屏模式下的主要快捷键**

- Ctrl + w 然后再按 Ctrl + w ：从一个 viewport 移动光标到另一个 viewport
- Ctrl + w 然后再按 j，那就移动到下方的 viewport（同理 h，k，l 会怎么移动很容易想到吧 ^_^）

| 按键                | 作用                  |
| ------------------- | --------------------- |
| Ctrl + w 然后再按 h | 移动到左方的 viewport |
| Ctrl + w 然后再按 j | 移动到下方的 viewport |
| Ctrl + w 然后再按 k | 移动到上方的 viewport |
| Ctrl + w 然后再按 l | 移动到右方的 viewport |

- Ctrl + w 然后再按 +（或 - ）：扩大（或缩小）当前的 viewport
- Ctrl + w 然后再按 =：重新均匀分配各个 viewport 的占比
- Ctrl + w 然后再按 r：调换 viewport 的位置
- Ctrl + w 然后再按 q 或按 c：关闭当前 viewport**（输入 :quit 或 :close 也有一样的效果）**
- Ctrl + w 然后再按 o（only）：只保留当前的 viewport，关闭其他

### :!  运行外部命令

- 在 Vim 中可以运行一些终端命令
- :!ls：在 vim 打开的文件的所在目录运行 ls 命令

## 5-4 vim 的可视模式

- visual mode 相当于高亮选取文本之后的 **交互/正常模式**

进入可视模式的方法（都是从交互模式开始的）：

- v：字符可视模式
  - 按下 d 可以删除
- V：行可视模式
- Ctrl + v：块可视模式
  - 配合 d 和 I（大写的 i）键可以实现很方便的操作
  - d 键用于删除选中的内容
  - I（大写的 i）键用于插入内容（用法是，按了 I 之后，再按两次 esc）
  - U：将选中的文本变为大写
  - u：将选中的文本变为小写

## 5-5 配置 vim

- 可以右两种方式来配置 vim
  - 激活或不激活选项参数
  - 安装插件

### 选项参数的作用

- 在 vim 被启动了以后，可以运行一些指令来激活一些选项参数（比如：set nu），但这些选项参数的配置在退出 vim 的时候会被忘记。
- 如果希望所作的配置是永久性的，那就需要在自己的家目录创建一个 vim 的配置文件：**.vimrc**

### 以命令模式激活选项参数

- 一旦 vim 被打开后，要激活一个选项参数，只需要输入：**:set 选项名**（取消选项参数：**:set no选项名**）
- 有些选项参数需要被指定一个值：**:set 选项名=数值**
- 了解选项参数的状态：**:set 选项名？**

### 在配置文件中配置选项参数

- 在家目录里面没有 .vimrc 这个文件；但是在 /etc 目录中有一个文件叫做 vimrc（这是全局的 vim 配置文件）
- **cp /etc/vimrc ~/.vimrc**：将全局的 vimrc 文件拷贝到家目录下的 .vimrc 文件中
- 配置有三种情况：
  - 可能这个选项参数已经存在也已经被激活（前面没有 "（双引号））
  - 可能这个选项参数已经存在但没有被激活（前面有 "（双引号））
  - 可能这个选项参数没存在，你自己添加

选项参数：

- syntax：语法高亮
  - 配置了以后 vim 会根据你打开的文件类型不同来对文件的文本进行对应的语法高亮
  - vim 支持多种编程语言类型文件：c，c++，python，java 等等
  - 要激活语法高亮，只需要保证 syntax on 这一句前面没有双引号即可

- number：显示行号
  - 在配置文件中加上：**set number**

- showcmd：显示当前命令
  - 当在 vim 中输入命令的时候，有时（主要在交互模式下）不能看到自己输入的命令
  - 在配置文件中加上：**set showcmd**

- ignorecase：在查找时忽略大小写
  - 默认在 vim 中搜索文本的时候是不忽略大小写的
  - 要忽略：**set ignorecase**

- mouse：鼠标支持

  - 激活鼠标：**set mouse=a**

    

## 5-6 版本控制

- version control software

版本控制软件主要有两方面用处

- 追踪源代码的演进：记住对每个文件所作的改动
- 使得多人可以协同工作：如果多个人同时编辑同一文件，它们的改动能够被正确合并，不怕丢失信息

### 集中式（Centralized）版本控制软件

- 有一个中央服务器，负责保存项目文件的所有历史版本
- 开发者需要连接到服务器，才能知道哪些文件被别的开发者修改过
- 并提交自己的改动

### 分布式（Distributed）版本控制软件

- 不需要有一个中央服务器
- 每一个开发者的电脑里都保存了项目文件的所有历史版本
- 开发者之间可以用点对点的方式来直接传递彼此所作的修改

## 5-7 git 小知识

- git 速度快，功能很多
- 支持分支（branch），而且管理分支的方式非常灵活

### SCM 软件

- SCM 是 Source/Software Configuration Management 的缩写，表示 "源码/软件 配置管理"
- SVN、Mercurial、Git 等版本控制软件一般也称为 SCM 软件

## 5-8 安装和配置 git

### 安装 git

- **sudo yum install -y git**：-y 的意思就是同意，就是不需要你再输入 y 了
- 也可以安装图形界面的版本，例如 **sudo yum install gitk**
  - gitk 是一个图形界面的软件，服务器上的命令行界面用不上

### 配置 git

配置 git 可以用 **git config** 后接各种参数

激活颜色选项：**git config --globel color.ui auto**

- 激活具体的颜色选项：
  - git config --globel color.diff auto
  - git config --globel color.status auto
  - git config --globel color.branch auto
- 关闭颜色选项：git config --global color.ui false

配置用户名

- git config --global user.name "你的用户名"：配置用户名
- git config --global --replace-all user.name "新的用户名"：修改用户名

配置邮箱

- git config --global user.email "你的邮箱"：设置邮箱
- git config --global --replace-all user.email：修改邮箱

### 查看 git 的配置

- 用命令来查看：**git config --list**
- 直接查看用户的家目录下的 **.gitconfig** 文件

### 设置 git 命令的别名

- 例如：**git config --global alias.co checkout**：alias 是“别名”的意思，用 git co 就等同于用 git checkout 命令

